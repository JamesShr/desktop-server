name: Validate SBOM (CycloneDX)

on:
  workflow_run:
    workflows: ["Generate SBOM"]   # ğŸ‘ˆ å°æ‡‰ä¸Šä¸€æ­¥çš„ workflow name
    types:
      - completed

jobs:
  validate:
    runs-on: ubuntu-latest

    steps:
      # 1ï¸âƒ£ ä¸‹è¼‰ä¸Šå€‹ workflow ä¸Šå‚³çš„ Artifact
      - name: Download SBOM Artifact
        uses: actions/download-artifact@v4
        with:
          name: desktop-server-sbom-spdx   # ğŸ‘ˆ å°æ‡‰ä¸Šä¸€ä»½ artifact-name
          path: ./sbom

      # 2ï¸âƒ£ å®‰è£ CycloneDX CLI
      - name: Install CycloneDX CLI
        run: |
          curl -L -o cyclonedx \
            https://github.com/CycloneDX/cyclonedx-cli/releases/latest/download/cyclonedx-linux-x64
          chmod +x cyclonedx
          sudo mv cyclonedx /usr/local/bin/cyclonedx
          cyclonedx version

      # 3ï¸âƒ£ é©—è­‰ SBOM æª”æ¡ˆï¼ˆSPDX æ ¼å¼ï¼‰
      - name: Validate SBOM file
        run: |
          echo "ğŸ§¾ Validating SBOM file..."
          ls -lh ./sbom
          cyclonedx validate \
            --input ./sbom/desktop-server.spdx.json \
            --input-format spdx-json

      # 4ï¸âƒ£ é©—è­‰æˆåŠŸæç¤º
      - name: Validation completed
        run: echo "âœ… SBOM validation passed successfully!"
